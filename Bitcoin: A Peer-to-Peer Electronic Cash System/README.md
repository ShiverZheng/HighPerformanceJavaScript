## Bitcoin: A Peer-to-Peer Electronic Cash System
- 电⼦现⾦系统
  
  允许在线⽀付直接从⼀⽅发送到另⼀⽅，⽽⽆需通过⾦融机构，但需要被信任的第三⽅来防⽌[双重支付](https://zh.wikipedia.org/wiki/%E9%9B%99%E9%87%8D%E6%94%AF%E4%BB%98)。
- 比特币
  
  使⽤点对点⽹络去解决双重⽀出问题。它为每笔交易标记时间戳。
  
  > 把交易的散列数据录⼊⼀个不断延展的、以散列为基础的⼯作证明链上，形成⼀个如⾮完全重做就不可能改变的记录，最⻓链。
  
  > ⼀⽅⾯⽤来证明已被⻅证的事件及其顺序，与此同时，也⽤来证明它来⾃于最⼤的 CPU 算⼒池。只要绝⼤多数 CPU 算⼒被良性节点控制。那么，良性节点将会⽣成最⻓链，并且在速度上超过攻击者。
  
  > 这个⽹络本身需要最⼩化的结构。信息将以最⼤努⼒为基本去传播，节点来去⾃由；但，加⼊之时总是需要接受最⻓的⼯作证明链作为它们未参与期间所发⽣之⼀切的证明。

### 基于加密证明的电子支付系统 

互联网商业几乎完全依赖金融机构作为可信任第三方处理电子支付，由于金融机构不可避免的需要仲裁纠纷，所以会出现下述问题：

> 交易可被撤销 ===> 增加交易成本 ===> 限制最小实际交易额度 ===> 杜绝小额交易的可能性 ===> 增加信任需求

基于密码学原理的电子支付系统，允许任何有交易意愿的双方能直接交易而不需要一个可信任第三方。使用点对点分布式时间戳服务器为基于时间的交易序列生成计算上的证据来解决双重支付问题。只要**诚实节点集体控制的 CPU 算力大于每一个合作攻击节点群的 CPU 算力**，那么这个系统就是安全的。

### 交易

- 记录上一笔交易的hash以及新的拥有者的公钥，形成一个数字签名链。
- 让所有参与者接收到一个唯一的交易历史，从而避免依赖“铸币厂”这样的中心存在。

### 时间戳服务器

![timestamp](./timestamp.png)

时间戳服务器计算包含多个需要被打时间戳的数据
项的区块的哈希值并广泛地发布这个哈希值。每个时间戳的哈希值都纳入了上一个时间戳，形成一条链，后面的时间戳进一步增强前一个时间戳。

### 工作量证明

![proof](./proof.png)
工作量证明采取搜索一个数，使得被哈希时，如使用 SHA-256，得到的哈希值以数个`0`开始。平均所需工作量将随所需`0`呈指数级增长而验证却只需执行一次哈希。
> 难以寻找，易于验证

工作方式：在区块中加入一个随机数，直到使得区块的哈希值满足所需`0`的数被找到。

一旦消耗了 CPU 算力使区块满足了工作量证明，除非重做这个工作否则就无法更改区块。由于后面的区块是链接在这个区块后面的，改变这个区块将需要重做所有后面的区块。

> 最长的链代表了最大的算力

基于平均每小时产生的区块数量的一个移动平均值，来应对硬件算力综合的不断增加，以及随着时间推进可能产生的节点参与数量变化， 如果区块生成得过快，那么难度将会增加。

### 网络

运⾏⽹络的步骤如下：
1. 向所有节点⼴播所有新的交易
2. 每个节点将新交易收集到⼀个区块中
3. 每个节点开始为此区块找⼀个具备难度的⼯作证明
4. 当某个区块找到其⼯作证明，它就要将此区块⼴播给所有节点
5. 众多其他节点当且只当以下条件满⾜才会接受这个区块：
   1. 其中所有的交易都是有效的
   2. 且未被双重⽀付
6. 在创建下⼀个区块的时候，把被接受区块的哈希当作新区块之前的哈希，表示接受该区块

节点始终认为最长链条是正确的，且会不断向其添加新的数据。若存在两个节点同时向网络广播了两个不同的节点，会先接收其中一个，另一个将被暂存。

当下⼀个⼯作证明被找到，⽽其中的⼀个分⽀成为更⻓的链之后，暂存的分支取消，在另外⼀个分⽀上⼯作的节点们会切换到更⻓的链上。

如果某个广播被忽略，在接收到下一个区块的时候会发出补充遗失区块的请求。

### 奖励

来自：
1. 每个区块的第一笔交易会生成一枚属于该区块生成者的硬币。
    > 通过消耗CPU的算力，以及电力，提供了将硬币发行到流通的方式。

2. 交易费用。
   > 交易的输出小于输入的差额。

   > 奖励节点将交易打包进区块。

保持诚实节点价值。

### 回收磁盘空间

如果最近的交易已经被纳入了足够多的区块之中，那么就可以丢弃该交易之前的数据，以回收硬盘空间。

[关于比特币的磁盘空间回收](https://www.chengweiyang.cn/2018/06/03/bitcoin-reclaiming-disk-space/)

### 简化版支付确认

当诚实节点控制网络时，用户只需要有一份拥有工作证明的最长链的区块头拷贝，就可以通过在线查询节点来确认是否来自最长链，而后获取Merkel树的树枝节点，进而连接这个区块被打上时间戳时的交易。

当攻击者控制网络时，客户端需接收来自网络节点的警告。

对于高频交易，应运行属于自己的完整节点以保证安全性。

### 价值的组合与分割

为了允许价值的分割与合并，交易记录包含多个输入和输出。

一般情况下

输入：
- 一个单独的来自于一个相对大的之前的交易的输入
- 很多个输入来自于更小金额的组合
  
输出:
- 支付（收款方）
- 如果必要，另外一个是找零（发款方）

### 隐私

公钥匿名
> 公众可以看到转账金额，但没有信息指向某个确定的人。

每笔交易都会启动一对新的公私钥，防止他人追溯交易到同一所有者。

### [计算](https://github.com/xiaolai/bitcoin-whitepaper-chinese-translation/blob/master/Bitcoin-Whitepaper-EN-CN.md#11-%E8%AE%A1%E7%AE%97-calculations)



### 总结

我们提出了一个**不必依赖信任**的**电子交易系统**；起点是一个普通的使用**数字签名**的硬币框架开始，虽然它提供了健壮的所有权控制，却无法避免**双重支付**。为了解决这个问题，我们提出一个使用工作证明机制的点对点网络去记录一个公开的交易记录历史，只要诚实节点能够控制大多数 CPU 算力，那么攻击者就仅从算力方面就不可能成功篡改系统。这个网络的健壮在于它的无结构的简单。节点们可以在很少协同的情况下瞬间同时工作。它们甚至不需要被辨认，因为消息的路径并非取决于特定的终点；消息只需要被以最大努力为基本去传播即可。节点来去自由，重新加入时，只需要接受工作证明链，作为它们离线之时所发生之一切的证明。它们通过它们的 CPU 算力投票，通过不断为链添加新的有效区块、拒绝无效区块，去表示它们对有效交易的接受与否。任何必要的规则和奖励都可以通过这个共识机制来强制实施。

