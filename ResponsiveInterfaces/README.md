## 浏览器UI线程 The Browser UI Thread

### 浏览器限制 Browser Limits

浏览器在 JavaScript 运行时间上采取了限制。这是一个有必要的限制，确保恶意代码编写者不能通过无 尽的密集操作锁定用户浏览器或计算机。

此类限制有两个:
1. 调用栈尺寸限制
    >第四章讨论过
1. 长运行脚本限制
    > 有时被称作长运行脚本定时器或者失控脚本定时器，但其基本思想是浏览器记录 一个脚本的运行时间，一旦到达一定限度时就终止它。

有两种方法测量脚本的运行时间。
1. 统计自脚本开始运行以来执行过多少语句。
   > 此方法意味着脚本在不同的机器上可能会运行不同的时间长度，可用内存和CPU速度可以影响一条独立语句运行所花费的时间。

1. 统计脚本运行的总时间。
   > 在特定时间内可运行的脚本数量也因用户机器性能差异而不同，但脚本总是停在固定的时间上。毫不奇怪，每个浏览器对长运行脚本检查方法上略有不同。


### 多久才算“太久”？How Long Is Too Long?

即使一秒钟对脚本 运行来说也太长了。一个单一的 JavaScript 操作应当使用的总时间(最大)是 100 毫秒。这个数字根据 Robert Miller 在 1968 年的研究。有趣的是，可用性专家 Jakob Nielsen 在他的著作《可用性工程》(Morgan Kaufmann， 1944)上注释说这一数字并没有因时间的推移而改变，而且事实上在 1991 年被 Xerox-PARC(施乐公司的 帕洛阿尔托研究中心)的研究中重申。

Nielsen 指出如果该接口在 100 毫秒内响应用户输入，用户认为自己是“直接操作用户界面中的对象。” 超过 100 毫秒意味着用户认为自己与接口断开了。由于 UI 在 JavaScript 运行时无法更新，如果运行时间长 于 100 毫秒，用户就不能感受到对接口的控制。

### 用定时器让出时间片 Yielding with Timers

#### 定时器基础 Timers Basics

定时器与 UI 线程交互的方式有助于分解长运行脚本成为较短的片断。调用 setTimeout()或 setInterval() 告诉 JavaScript 引擎等待一定时间然后将 JavaScript 任务添加到 UI 队列中。例如:

```js
function greeting() {
    alert("Hello world!")
}
setTimeout(greeting, 250)
```